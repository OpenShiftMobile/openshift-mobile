<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!--meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" /-->
		<meta name="viewport" content="user-scalable=no,width=device-width,target-densitydpi=device-mdpi,initial-scale=1,maximum-scale=1"/>
        <link rel="stylesheet" type="text/css" href="css/osm.css" />
        <link rel="stylesheet" type="text/css" href="css/rht.min.css" />
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile.structure-1.3.2.min.css" />
        <title>OpenShift Mobile</title>
    </head>
    <body>

		<!-- LOGIN PAGE -->
		<div id="login-page" data-role="page" class="prerender">
			<div data-role="header">
				<h1>Login</h1>
			</div>

			<div data-role="content" data-theme="a">
				<span id="login-instruct">Login to OpenShift</span>
				<div id="login-container">
					<div data-role="fieldcontain">
						<input id="login-username" type="text" value="" placeholder="Username"/>
					</div>
					<div data-role="fieldcontain">
						<input id="login-password" type="password" value="" placeholder="Password"/>
					</div>
					<div data-role="fieldcontain">
						<fieldset data-role="controlgroup">
							<input type="radio" name="login-openshift-type-radio-group" id="login-openshift-type-radio-group-online" value="online" checked="checked" />
						     	<label for="login-openshift-type-radio-group-online">OpenShift Online</label>
						
						     	<input type="radio" name="login-openshift-type-radio-group" id="login-openshift-type-radio-group-enterprise" value="enterprise"  />
						     	<label for="login-openshift-type-radio-group-enterprise">OpenShift Enterprise</label>
						</fieldset>
					</div>
					<div data-role="fieldcontain" id="login-enterprise-url-div">
						<input id="login-enterprise-url" type="text" value="" placeholder="OpenShift Enterprise Rest Url"/>
					</div>
					
						
					<div data-role="fieldcontain">
						<input id="login-auto" type="checkbox" data-theme="a"/>
						<label for="login-auto">Automatically Login</label>
					</div>
					<div data-role="fieldcontain">
						<button id="login-submit">Login</button>
					</div>

				</div>
			</div>
		</div>
		<!-- END LOGIN PAGE -->

		<!-- DOMAINS PAGE -->
		<div id="domains-page" data-role="page" class="prerender">
			<div id="domain-nav-panel" data-role="panel" data-theme="b" class="navpanel" data-display="overlay">
				<ul data-role="listview" data-theme="b">
					<li data-role="list-divider" role="heading">Account</li>
					<li data-icon="gear"><a>Settings</a></li>
					<li data-icon="back"><a class="toLogout">Logout</a></li>
				</ul>
			</div>
			<div data-role="header">
				<a href="#domain-nav-panel" data-icon="bars" data-iconpos="notext"></a>
				<h1>Domains</h1>
			</div>

			<div data-role="content">
				<div id="domain-emtpy-list" style="display:none;text-align:center">No Domains Exist</div>
				<ul id="domain-list" data-role="listview" data-theme="a"></ul>
			</div>
		</div>
		<!-- END PAGE -->

		<!-- APPLICATIONS PAGE -->
		<div id="applications-page" data-role="page" class="prerender">
			<div id="applications-nav-panel" data-role="panel" data-theme="b" class="navpanel"  data-display="overlay">
				<ul data-role="listview" data-theme="b">
					<li data-role="list-divider" role="heading">Navigation</li>
					<li data-icon="arrow-l"><a class="toDomains">Domains</a></li>
					<li data-icon="plus"><a class="createapp">Create Application</a></li>
					<li data-role="list-divider" role="heading">Account</li>
					<li data-icon="gear"><a>Settings</a></li>
					<li data-icon="back"><a class="toLogout">Logout</a></li>
				</ul>
			</div>

			<div data-role="header">
				<a href="#applications-nav-panel" data-icon="bars" data-iconpos="notext"></a>
				<h1>Applications</h1>
				<a href="" class="createapp" data-icon="plus" data-iconpos="notext"></a>
			</div>

			<div data-role="popup" data-theme="b" id="application-popupMenu">
				<ul data-role="listview" data-inset="true" style="min-width:210px;" data-theme="a">
					<li data-role="divider" data-theme="b">Actions</li>
					<li><a id="application-view">View Application</a></li>
					<li data-icon="arrow-u"><a id="application-start">Start Application</a></li>
					<li data-icon="arrow-d"><a id="application-stop">Stop Application</a></li>
					<li data-icon="refresh"><a id="application-restart">Restart Application</a></li>
					<li data-theme="c" data-icon="delete"><a id="application-delete">Delete Application</a></li>
				</ul>
			</div>

			<div data-role="content">
				<!-- Begin Popup Dialog -->
				<div data-role="popup" id="applications-popup-alert-dialog" data-overlay-theme="a" data-theme="a" style="max-width:500px" class="ui-corner-all">
					<div data-role="header" data-theme="a" class="ui-corner-top">
						<div>
							<h3 id="applications-popup-alert-dialog-header" style="text-align:center"></h3>
						</div>
					</div>
					<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content">
						<h3 id="applications-popup-alert-dialog-content" class="ui-title"></h3>
						<a href="#" data-role="button" data-inline="true" data-rel="back">OK</a>    
					</div>
				</div>
				<!-- End Popup Dialog -->			

				<!-- Begin Confirmation Dialog -->
				<div data-role="popup" id="applications-popup-confirm-dialog" data-overlay-theme="a" data-theme="a" style="max-width:500px" class="ui-corner-all">
					<div data-role="header" data-theme="a" class="ui-corner-top">
						<div>
							<h3 id="applications-popup-confirm-dialog-header" style="text-align:center"></h3>
						</div>
					</div>
					<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content">
						<h3 id="applications-popup-confirm-dialog-content" class="ui-title"></h3>
						<a href="#" data-role="button" data-inline="true" id="applications-popup-confirm-dialog-no-button">No</a>
						<a href="#" data-role="button" data-inline="true" id="applications-popup-confirm-dialog-yes-button" data-theme="c">Yes</a>    
					</div>
				</div>
				<!-- End Confirmation Dialog -->
				<div id="application-emtpy-list" style="display:none;text-align:center">No Applications Exist</div>
				<ul id="application-list" data-role="listview" data-theme="a" data-split-icon="arrow-d"></ul>
			</div>
		</div>
		<!-- END PAGE -->

		<!-- Create Application Page -->
		<div id="new-application-page" data-role="page" class="prerender">
			<div data-role="header">
				<h1>Create New Application</h1>
			</div>

			<div data-role="content">
				<!-- Begin Popup Dialog -->
				<div data-role="popup" id="new-application-popup-alert-dialog" data-overlay-theme="a" data-theme="a" style="max-width:500px" class="ui-corner-all">
					<div data-role="header" data-theme="a" class="ui-corner-top">
						<div>
							<h3 id="new-application-popup-alert-dialog-header" style="text-align:center"></h3>
						</div>
					</div>
					<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content">
						<h3 id="new-application-popup-alert-dialog-content" class="ui-title"></h3>
						<a href="#" data-role="button" data-inline="true" data-rel="back">OK</a>    
					</div>
				</div>
				<!-- End Popup Dialog -->			
				<div id="create-application-container" data-theme="a">
					<form id="new-application-form" data-ajax="false">
						<div data-role="fieldcontain">
							 <input type="text" name="name" id="new-application-name" value="" placeholder="Application Name"  data-theme="a"  />
						</div>				
						<div data-role="fieldcontain">
							<select name="cartridge" id="new-application-cartridge" data-native-menu="false" data-theme="a">
							<option value="application-cartridge-type" data-placeholder="true" data-theme="a">Cartridge Type</option>
							</select>
						</div>
						<div data-role="fieldcontain">
							<a data-role="button" data-rel="back" data-inline="true"  data-theme="a">Cancel</a>
							<button id="create-application-submit" data-role="button" data-inline="true" data-theme="a">Create</button>
						</div>
					</form>
				</div>
			</div>
		</div>		
		<!-- END Create Application Page -->

		<!-- Application Content Page -->
		<div id="app-content-page" data-role="page" class="prerender">
			<div id="app-content-nav-panel" data-role="panel" data-theme="b" class="navpanel"  data-display="overlay">
				<ul data-role="listview" data-theme="b">
					<li data-role="list-divider" role="heading">Navigation</li>
					<li data-icon="arrow-l"><a class="toDomains">Domains</a></li>
					<li data-icon="arrow-l"><a class="toApplications">Applications</a></li>
					<li data-role="list-divider" role="heading">Account</li>
					<li data-icon="gear"><a>Settings</a></li>
					<li data-icon="back"><a class="toLogout">Logout</a></li>
				</ul>
			</div>
			
			<div data-role="header">
				<a href="#app-content-nav-panel" data-icon="bars" data-iconpos="notext"></a>
				<h1 id="app-content-title">Application Content</h1>
				<a href="#" id="app-content-add" data-icon="plus" data-iconpos="notext"></a>
				<div data-role="navbar">
					<ul>
						<li><a data-theme="e" href="#" data-tab="app-content-info">Info</a></li>
						<li><a data-theme="e" href="#" data-tab="app-content-cartridges" data-display-add="true">Cartridges</a></li>
						<li><a data-theme="e" href="#" data-tab="app-content-aliases" data-display-add="true">Aliases</a></li>
					</ul>
				</div>
			</div>

			<div data-role="content" data-theme="a">
				<!-- Begin Popup Dialog -->
				<div data-role="popup" id="application-content-popup-alert-dialog" data-overlay-theme="a" data-theme="a" style="max-width:500px" class="ui-corner-all">
					<div data-role="header" data-theme="a" class="ui-corner-top">
						<div>
							<h3 id="application-content-popup-alert-dialog-header" style="text-align:center"></h3>
						</div>
					</div>
					<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content">
						<h3 id="application-content-popup-alert-dialog-content" class="ui-title"></h3>
						<a href="#" data-role="button" data-inline="true" data-rel="back">OK</a>    
					</div>
				</div>
				<!-- End Popup Dialog -->
				
				<!-- Begin Confirmation Dialog -->
				<div data-role="popup" id="application-content-popup-confirm-dialog" data-overlay-theme="a" data-theme="a" style="max-width:500px" class="ui-corner-all">
					<div data-role="header" data-theme="a" class="ui-corner-top">
						<div>
							<h3 id="application-content-popup-confirm-dialog-header" style="text-align:center"></h3>
						</div>
					</div>
					<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content">
						<h3 id="application-content-popup-confirm-dialog-content" class="ui-title"></h3>
						<a href="#" data-role="button" data-inline="true" id="application-content-popup-confirm-dialog-no-button">No</a>
						<a href="#" data-role="button" data-inline="true" id="application-content-popup-confirm-dialog-yes-button" data-theme="c">Yes</a>    
					</div>
				</div>
				<!-- End Confirmation Dialog -->
			
			
				<div class="tabs-content">
					<div id="app-content-info">
						<table style="text-align:left">
							<tbody>
								<tr><th>Name:</th><td></td></tr>
								<tr><th>ID:</th><td></td></tr>
								<tr><th>URL:</th><td></td></tr>
								<tr><th>Framework:</th><td></td></tr>
								<tr><th>Gears:</th><td></td></tr>
								<tr><th>Gear Profile:</th><td></td></tr>
								<tr><th>Scalable:</th><td></td></tr>
								<tr><th>Auto Deploy:</th><td></td></tr>
								<tr><th>Deployment Type:</th><td></td></tr>
								<tr><th>Deployment Branch:&nbsp;&nbsp;</th><td></td></tr>
							</tbody>
						</table>
					</div>
					<div id="app-content-cartridges">
						<div id="app-cartridge-emtpy-list" style="display:none;text-align:center">No Cartridges Exist</div>
						<ul id="app-cartridge-list" data-role="listview" data-theme="a" data-split-icon="arrow-d"></ul>
						<div data-role="popup" data-theme="b" id="cartridge-popupMenu">
							<ul data-role="listview" data-inset="true" style="min-width:210px;" data-theme="a">
								<li data-role="divider" data-theme="b">Actions</li>
								<li data-icon="arrow-u"><a id="cartridge-start">Start Cartridge</a></li>
								<li data-icon="arrow-d"><a id="cartridge-stop">Stop Cartridge</a></li>
								<li data-icon="refresh"><a id="cartridge-restart">Restart Cartridge</a></li>
								<li data-icon="refresh"><a id="cartridge-reload">Reload Cartridge</a></li>
								<li data-theme="c" data-icon="delete"><a id="cartridge-delete">Delete Cartridge</a></li>
							</ul>
						</div>
					</div>
					<div id="app-content-aliases">
						<div id="app-alias-emtpy-list" style="display:none;text-align:center">No Aliases Exist</div>
						<ul id="app-alias-list" data-role="listview" data-theme="a" data-split-icon="delete"></ul>
					</div>
				</div>
			</div>
		</div>
		<!-- END Application Content Page -->	
		
		<!-- Create Aliases Page -->
		<div id="new-alias-page" data-role="page" class="prerender">
			<div data-role="header">
				<h1>Create New Alias</h1>
			</div>

			<div data-role="content">
				<!-- Begin Popup Dialog -->
				<div data-role="popup" id="new-alias-popup-alert-dialog" data-overlay-theme="a" data-theme="a" style="max-width:500px" class="ui-corner-all">
					<div data-role="header" data-theme="a" class="ui-corner-top">
						<div>
							<h3 id="new-alias-popup-alert-dialog-header" style="text-align:center"></h3>
						</div>
					</div>
					<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content">
						<h3 id="new-alias-popup-alert-dialog-content" class="ui-title"></h3>
						<a href="#" data-role="button" data-inline="true" data-rel="back">OK</a>    
					</div>
				</div>
				<!-- End Popup Dialog -->			
				<div id="create-alias-container" data-theme="a">
					<form id="new-alias-form" data-ajax="false">
						<div data-role="fieldcontain">
							 <input type="text" name="id" id="new-alias-id" value="" placeholder="Alias Name"  data-theme="a"  />
						</div>				
						<div data-role="fieldcontain">
							<a data-role="button" data-rel="back" data-inline="true"  data-theme="a">Cancel</a>
							<button id="create-alias-submit" data-role="button" data-inline="true" data-theme="a">Create</button>
						</div>
					</form>
				</div>
			</div>
		</div>		
		<!-- END Create Aliases Page -->	
		
		<!-- Create Embedded Cartridge Page -->
		<div id="new-embedded-cartridge-page" data-role="page" class="prerender">
			<div data-role="header">
				<h1>Create Embedded Cartridge</h1>
			</div>

			<div data-role="content">
				<!-- Begin Popup Dialog -->
				<div data-role="popup" id="new-embedded-cartridge-popup-alert-dialog" data-overlay-theme="a" data-theme="a" style="max-width:500px" class="ui-corner-all">
					<div data-role="header" data-theme="a" class="ui-corner-top">
						<div>
							<h3 id="new-embedded-cartridge-popup-alert-dialog-header" style="text-align:center"></h3>
						</div>
					</div>
					<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content">
						<h3 id="new-embedded-cartridge-popup-alert-dialog-content" class="ui-title"></h3>
						<a href="#" data-role="button" data-inline="true" data-rel="back">OK</a>    
					</div>
				</div>
				<!-- End Popup Dialog -->			
				<div id="create-embedded-cartridge-container" data-theme="a">
					<form id="new-embedded-cartridge-form" data-ajax="false">
						<div data-role="fieldcontain">
							<select name="cartridge" id="new-embedded-cartridge-cartridge" data-native-menu="false" data-theme="a">
							<option value="new-embedded-cartridge-type" data-placeholder="true" data-theme="a">Cartridge Type</option>
							</select>
						</div>
						<div data-role="fieldcontain">
							<a data-role="button" data-rel="back" data-inline="true"  data-theme="a">Cancel</a>
							<button id="create-embedded-cartridge-submit" data-role="button" data-inline="true" data-theme="a">Create</button>
						</div>
					</form>
				</div>
			</div>
		</div>		
		<!-- END Create Embedded Cartridge Page -->



        <script type="text/javascript" src="phonegap.js"></script>
		<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="js/osm-framework.js"></script>
		<script type="text/javascript" src="js/osm-operations.js"></script>
		<script type="text/javascript">
			var app = OSM_Application();

			$(document).bind('osm-ready',function() {
				var settings = app.settings.load();

				$.mobile.changePage('#login-page',{transition:DEFAULT_TRANSITION});
				populateLoginForm(settings);

				if(settings.autolog) {
					loginToggleDisableFields();
					login(app,loginSuccess,loginFail);
				}
				$('[data-role="navbar"] a:first').click();
	
			});

			$('#login-submit').click(function() {
				var ent = $('#login-openshift-type-radio-group-enterprise').prop('checked');

				app.settings.save({
					username: $('#login-username').val(),
					password: $('#login-password').val(),
					autolog: $('#login-auto').prop('checked'),
					enterprise: ent,
					baseurl: ent ? $('#login-enterprise-url').val() : OPENSHIFT_ONLINE_URL
				});

				loginToggleDisableFields();
				login(app,loginSuccess,loginFail);
			});

			function populateLoginForm(settings) {
				$('#login-username').val(settings.username);
				settings.autolog ? $('#login-password').val(settings.password) : $('#login-password').val();
				$('#login-enterprise-url').val(settings.baseurl);
				$('#login-auto').prop('checked',settings.autolog).checkboxradio('refresh');
				$('#login-openshift-type-radio-group-enterprise').prop('checked',settings.enterprise).checkboxradio('refresh');
				$('#login-openshift-type-radio-group-online').prop('checked',!settings.enterprise).checkboxradio('refresh');
				$("input[name='login-openshift-type-radio-group']").change();
			}

			function loginToggleDisableFields() {
				$('#login-container').children().toggleClass('ui-disabled');
			}

			function loginSuccess(d) {
				$.mobile.changePage('#domains-page',{transition:DEFAULT_TRANSITION});
				loginToggleDisableFields();
				$.mobile.loading('hide');
			}

			function loginFail() {
				$('#login-instruct').text('Login Failed').css({'color':'#cc0000'});
				loginToggleDisableFields();
				$.mobile.loading('hide');
			}
			
			$('.toLogout').click(function() {
				logout(app);
			});

			$("input[name='login-openshift-type-radio-group']").change(function(e){
				var enterprise_url_textbox_div = $("#login-enterprise-url-div");
			    if($('#login-openshift-type-radio-group-enterprise').prop('checked')) {
    				enterprise_url_textbox_div.show();
			    } else {
    				enterprise_url_textbox_div.hide();
			    }
			});

			$('#domains-page').bind('pagebeforeshow',{app:app,list_id:'#domain-list',app_page_id:"#applications-page"},domain_list_build);
			$('#applications-page').bind('pagebeforeshow',{app:app,list_id:'#application-list',app_page_id:'#app-content-page'},application_list_build);
			$('#new-application-page').bind('pagebeforeshow',{app:app,list_id:'#new-application-cartridge',name_id:'#new-application-name'},application_type_list_build);
			$('#new-embedded-cartridge-page').bind('pagebeforeshow',{app:app,list_id:'#new-embedded-cartridge-cartridge'},embedded_cartridge_type_list_build);
			$('#app-content-page').bind('pagebeforeshow',{
				app:app,
				app_info_id:'#app-content-info',
				title_id:'#app-content-title',
				cartridge_list_id:'#app-cartridge-list',
				cartridge_empty_list_id:'#app-cartridge-emtpy-list',
				alias_list_id:'#app-alias-list'
			},application_content_build);


			$('#application-start').click(function() {
				process_application_action(app,'#application-popupMenu','#application-list','start','Starting','Started');
			});

			$('#application-stop').click(function() {
				process_application_action(app,'#application-popupMenu','#application-list','stop','Stopping','Stopped');
			});

			$('#application-restart').click(function() {
				process_application_action(app,'#application-popupMenu','#application-list','restart','Restarting','Restarted');
			});

			$('#application-view').click(function() {
				$('#application-popupMenu').popup('close');
				window.open(JSON.parse(localStorage[app.support.is_supported('applications.list',localStorage['sel_domain']).url]).data[localStorage['sel_application']].app_url,'_blank','location=no');
			});
	
			$('#application-delete').click(function() {
				$('#application-popupMenu').popup('close');

				var app_name = JSON.parse(localStorage[app.support.is_supported('applications.list',localStorage['sel_domain']).url]).data[localStorage['sel_application']].name;

				setTimeout(function() {
					show_confirm_dialog(
						$('#applications-popup-confirm-dialog'), 
						'Application Action',
						'Are you sure you want to delete ' + app_name + '?',
						function() {
							$("#application-popupMenu" ).popup( "close" );	
							$('#application-list').children().addClass('ui-disabled');
			
							$.mobile.loading('show', {
								text : 'Deleting ' + app_name,
								textVisible : true,
								theme : 'b',
							});	

							var support = app.support.is_supported('application.get');

							if(!support.supported) return false;

							app.rest.DELETE(support.url,function(data,text,xhr) {
								$.mobile.loading('hide');
								show_alert_dialog($("#applications-popup-alert-dialog"),"Application Operation", app_name + " Deleted Successfully");
								$('#application-list').children().removeClass('ui-disabled');
								refresh();
							},
							function(xhr,err,exception) {
								$.mobile.loading('hide');
								show_alert_dialog($("#applications-popup-alert-dialog"),"Application Operation Failure", app_name + " Failed to be Deleted");
								$('#application-list').children().removeClass('ui-disabled');				
							});
						}
					);
				},200);
			});

			$('#create-application-submit').click(function() {
				var formdata = $('#new-application-form').serialize();
				$('#create-application-container').children().addClass('ui-disabled');

				$.mobile.loading('show', {
					text: 'Creating ' + $('#new-application-name').val(),
					textVisible: true,
					theme: 'b'
				});

				var support = app.support.is_supported('applications.add');
				if(!support.supported) return false;

				app.rest.POST(support.url,formdata, function(d) {
					$.mobile.loading('hide');
					$('#create-application-container').children().removeClass('ui-disabled');
					show_alert_dialog($("#new-application-popup-alert-dialog"),"Application Creation","Application Created Successfully", function(event,ui){
						history.back();
					});

				},
				function(xhr,err,exception) {
					if(xhr.status == '422') {
						var json = jQuery.parseJSON(xhr.responseText);
						var messages = "";

						$.each(json.messages,function(index,value) {
							if(messages != "") messages += "\n";
							messages += value.text;
						});

						show_alert_dialog($("#new-application-popup-alert-dialog"),"Application Creation Failed",messages);
					} else {
						show_alert_dialog($("#new-application-popup-alert-dialog"),"Application Creation Failed","The Application Failed to be Created");
					}
					$.mobile.loading('hide');
					$('#create-application-container').children().removeClass('ui-disabled');

				});

				return false;
			});
			
			$('#create-embedded-cartridge-submit').click(function() {
				var formdata = $('#new-embedded-cartridge-form').serialize();
				$('#create-embedded-cartridge-container').children().addClass('ui-disabled');

				$.mobile.loading('show', {
					text : 'Adding ' + $('#new-embedded-cartridge-cartridge option:selected').text(),
					textVisible : true,
					theme : 'b',
				});

				var support = app.support.is_supported('cartridges.add');
				if(!support.supported) return false;

				app.rest.POST(support.url, formdata,
					function(d) {
						$.mobile.loading('hide');
						$('#create-embedded-cartridge-container').children().removeClass('ui-disabled');
						show_alert_dialog($("#new-embedded-cartridge-popup-alert-dialog"),"Embedded Cartridge Creation","Embedded Cartridge Created Successfully", function(event,ui){
							history.back();
						});
					},
					function(jqxhr,errType,exception) {

						// Check to see if messages are returned from OpenShift
						if(jqxhr.status == "422") {

							var json = jQuery.parseJSON(jqxhr.responseText);
							var messages = "";

							$.each(json.messages, function(index,value) {
								if(messages != "") messages += "\n";
								messages += value.text;
							});

							show_alert_dialog($("#new-embedded-cartridge-popup-alert-dialog"),"Application Creation Failed",messages);
						}
						else {
							show_alert_dialog($("#new-embedded-cartridge-popup-alert-dialog"),"Embedded Cartridge Creation Failed","The Embedded Cartridge Failed to be Created");
						}

						$.mobile.loading('hide');
						$('#create-embedded-cartridge-container').children().removeClass('ui-disabled');
					}
				);

				return false;
			});
			
			$('#create-alias-submit').click(function() {
				var formdata = $('#new-alias-form').serialize();

				$('#create-alias-container').children().addClass('ui-disabled');

				$.mobile.loading('show', {
					text : 'Creating ' + $('#new-alias-id').val(),
					textVisible : true,
					theme : 'b',
				});

				var support = app.support.is_supported('aliases.add');
				if(!support.supported) return false;

				app.rest.POST(support.url, formdata,
					function(d) {
						$.mobile.loading('hide');
						$('#create-alias-container').children().removeClass('ui-disabled');
						show_alert_dialog($("#new-alias-popup-alert-dialog"),"Alias Creation","Alias Created Successfully", function(event,ui){
							history.back();
						});
					},
					function(jqxhr,errType,exception) {
						$.mobile.loading('hide');			
						// Check to see if messages are returned from OpenShift
						if(jqxhr.status == "422") {

							var json = jQuery.parseJSON(jqxhr.responseText);
							var messages = '';

							$.each(json.messages, function(index,value) {
								if(messages != '') messages += "\n";
								messages += value.text;
							});

							show_alert_dialog($("#new-alias-popup-alert-dialog"),"Alias Creation Failed",messages);
						}
						else {

							show_alert_dialog($("#new-alias-popup-alert-dialog"),"Alias Creation Failed","The Alias Failed to be Created");
						}

						$.mobile.loading('hide');
						$('#create-alias-container').children().removeClass('ui-disabled');
					}
				);

				return false;
			});

			$('.createapp').click(function() {
				$.mobile.changePage('#new-application-page',{transition:DEFAULT_TRANSITION});
			});	
			
			$('.toDomains').click(function() {
				$.mobile.changePage('#domains-page',{transition:DEFAULT_TRANSITION});
			});	
			
			$('.toApplications').click(function() {
				$.mobile.changePage('#applications-page',{transition:DEFAULT_TRANSITION});
			});
			
			$('#app-content-add').click(function() {
				$(document).trigger("osm-new-" + $(this).data('app-content-trigger'));
			});

			$('#cartridge-start').click(function() {
				process_cartridge_action(app,'#cartridge-popupMenu','#app-cartridge-list','start','Starting','Started');
			});

			$('#cartridge-stop').click(function() {
				process_cartridge_action(app,'#cartridge-popupMenu','#app-cartridge-list','stop','Stopping','Stopped');
			});

			$('#cartridge-reload').click(function() {
				process_cartridge_action(app,'#cartridge-popupMenu','#app-cartridge-list','reload','Reloading','Reloaded');
			});

			$('#cartridge-restart').click(function() {
				process_cartridge_action(app,'#cartridge-popupMenu','#app-cartridge-list','restart','Restarting','Restarted');
			});

			$('#cartridge-delete').click(function() {

				$('#cartridge-popupMenu').popup('close');

				var cartridge_name = JSON.parse(localStorage[app.support.is_supported('application.cartridges').url]).data[localStorage['sel_cartridge']].name;

				setTimeout(function() {
					show_confirm_dialog(
						$('#application-content-popup-confirm-dialog'),
						'Cartridge Action',
						'Are you sure you want to delete ' + cartridge_name + '?', 
						function() {

							$('#app-cartridge-list').children().addClass('ui-disabled');

							$.mobile.loading('show', {
								text : 'Deleting ' + cartridge_name,
								textVisible : true,
								theme : 'b'
							});

							var support = app.support.is_supported('cartridge.get');
							if(!support.supported) return false;

							app.rest.DELETE(support.url,function(data,text,xhr) {
								$.mobile.loading('hide');
								show_alert_dialog(
									$('#application-content-popup-alert-dialog'),
									'Cartridge Operation',
									cartridge_name + 'Deleted Successfully'
								);

								$('#app-cartridge-list').children().removeClass('ui-disabled');
								refresh();
							},
							function(xhr,err,exception) {
								$.mobile.loading('hide');

								if(xhr.status === '422') {
									var json = jQuery.parseJSON(xhr.responseText);
									var messages = '';

									$.each(json.messages,function(index,value) {
										if(messages != '') {
											messages += "\n";
										}
										messages += value.text;
									});

									show_alert_dialog($('#application-content-alert-dialog'),'Cartridge Operation Failed',messages);
								} else {
									show_alert_dialog($('#application-content-alert-dialog'),'Cartridge Operation Failed',cartridge_name + ' Failed to be Deleted');
								}

								$('#app-cartridge-list').children().removeClass('ui-disabled');

							});
						}
					);
				},200);

			});
			
			
			$(document).bind('osm-new-app-content-aliases',function() {
				$.mobile.changePage('#new-alias-page',{transition:DEFAULT_TRANSITION});
			});

			$(document).bind('osm-new-app-content-cartridges',function() {
				$.mobile.changePage('#new-embedded-cartridge-page',{transition:DEFAULT_TRANSITION});
			});



			$(document).delegate('[data-role="navbar"] a', 'click', function() {
				$('[data-role="navbar"] a').removeClass('ui-btn-active ui-state-persist');
				$('.tabs-content').children().hide();
				$('#' + $(this).attr('data-tab')).show();
				$('html,body').animate({scrollTop:0},500);
				$(this).addClass('ui-btn-active ui-state-persist');
				var app_content_add_button = $("#app-content-add");
				app_content_add_button.hide();				
				var new_content_add_data = $(this).attr('data-display-add');
				if(new_content_add_data !== null && typeof new_content_add_data !== 'undefined' && new_content_add_data === 'true') {
					app_content_add_button.show();
					app_content_add_button.data("app-content-trigger",$(this).attr("data-tab"));
				}				
			});
        </script>

		<!-- IMPORTANT: Load this last to make sure all event bindings are set before the events fire -->		
		<script type="text/javascript" src="js/jquery.mobile-1.3.2.min.js"></script>
    </body>
</html>
